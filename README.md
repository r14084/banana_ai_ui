# üçå Banana AI Prompt Expander

**‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô AI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏° Prompt ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢ Google Gemini API**

‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏° prompt ‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á

## ‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å

### üé® AI Prompt Expansion
- **‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏° Style ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô**: ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏†‡∏≤‡∏û
- **‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢**: UI ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
- **Google Gemini API**: ‡πÉ‡∏ä‡πâ Gemini 2.0 Flash ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á
- **Smart Caching**: ‡πÅ‡∏Ñ‡∏ä‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß

### üì∏ Image Reference System
- **Upload ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î**: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏° +
- **Drag & Drop**: ‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å
- **Preview System**: ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- **Remove Function**: ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏° √ó ‡∏™‡∏µ‡πÅ‡∏î‡∏á

### üéõÔ∏è Advanced Controls
- **Aspect Ratio**: 9:16 (Portrait) ‡∏´‡∏£‡∏∑‡∏≠ 16:9 (Landscape)
- **Guidance Scale**: ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ï‡∏≤‡∏° prompt (1-20)
- **Inference Steps**: ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (1-100)
- **Negative Prompt**: ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏†‡∏≤‡∏û

### üåô Modern UI
- **Dark Theme**: ‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤
- **Thai Font**: ‡πÉ‡∏ä‡πâ Noto Sans Thai ‡∏î‡∏π‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
- **Responsive**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
- **Smooth Animations**: ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ó‡∏µ‡πà‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•

### üõ°Ô∏è Security & Performance
- **Rate Limiting**: ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô API
- **CSRF Protection**: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ
- **Input Validation**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
- **Health Monitoring**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö

## üìã ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

- **Python**: 3.8 ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
- **Google Gemini API Key**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô AI
- **‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£**: Windows, macOS, Linux

## üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

### 1. Clone ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
```bash
git clone [repository-url]
cd banana_ai_ui
```

### 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Virtual Environment
```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á virtual environment
python -m venv .venv

# ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô virtual environment
# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Windows
.venv\Scripts\activate

# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö macOS/Linux
source .venv/bin/activate
```

### 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies
```bash
pip install -r requirements.txt
```

### 4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `.env`:
```env
# Google Gemini API Key (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
GEMINI_API_KEY=your_api_key_here

# ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Flask
SECRET_KEY=your_secret_key_here
MAX_CONTENT_MB=20

# ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•
LLM_MODEL=gemini-2.5-flash
BANANA_MODEL=gemini-2.5-flash-image-preview

# ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
UPLOAD_FOLDER=uploads
OUTPUT_FOLDER=output
LOG_FOLDER=logs

# Rate Limiting
RATE_LIMIT_ASSIST=10
RATE_LIMIT_UPLOAD=5

# Cache
CACHE_TTL=3600
CACHE_MAX_SIZE=100
```

### 5. ‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô
```bash
python app.py
```

‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà: `http://localhost:8000`

## üìÅ Project Structure

```
banana-ai/
‚îú‚îÄ‚îÄ app.py                  # Main Flask application
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ .env.example           # Environment variables template
‚îú‚îÄ‚îÄ bananaai/              # Application package
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # Configuration management
‚îÇ   ‚îú‚îÄ‚îÄ middleware/        # Security, rate limiting, error handling
‚îÇ   ‚îú‚îÄ‚îÄ services/          # Business logic (LLM, caching)
‚îÇ   ‚îú‚îÄ‚îÄ utils/             # Utilities (validation, logging)
‚îÇ   ‚îî‚îÄ‚îÄ routes/            # API and UI routes
‚îú‚îÄ‚îÄ templates/             # HTML templates
‚îú‚îÄ‚îÄ static/                # CSS and JavaScript
‚îú‚îÄ‚îÄ tests/                 # Test suite
‚îî‚îÄ‚îÄ uploads/               # User uploaded files
```

## üîß Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `GEMINI_API_KEY` | Google Gemini API key | Required |
| `LLM_MODEL` | Model for prompt expansion | gemini-2.5-flash |
| `BANANA_MODEL` | Model for image generation | gemini-2.5-flash-image-preview |
| `SECRET_KEY` | Flask secret key | dev-key-change-in-production |
| `UPLOAD_FOLDER` | Directory for uploads | uploads |
| `OUTPUT_FOLDER` | Directory for generated images | output |
| `LOG_FOLDER` | Directory for logs | logs |
| `MAX_CONTENT_MB` | Max upload size (MB) | 20 |
| `RATE_LIMIT_ASSIST` | Rate limit for /assist (per min) | 10 |
| `RATE_LIMIT_UPLOAD` | Rate limit for /upload (per min) | 5 |
| `CACHE_TTL` | Cache time-to-live (seconds) | 3600 |
| `FILE_CLEANUP_HOURS` | File retention period (hours) | 24 |

## üì° API Endpoints

### POST `/api/assist`
Expand prompt using AI

**Request:**
```json
{
  "prompt": "beautiful sunset over mountains",
  "aspect_ratio": "16:9"
}
```

**Response:**
```json
{
  "expanded": "Detailed expanded prompt...",
  "cached": false
}
```

### POST `/api/generate`
Generate image using Gemini 2.5 Flash Image Preview

**Request:**
```json
{
  "prompt": "beautiful sunset over mountains",
  "aspect_ratio": "16:9",
  "negative_prompt": "blurry, bad quality",
  "guidance_scale": 7.5,
  "num_inference_steps": 20,
  "reference_images": ["uploaded_image1.jpg", "uploaded_image2.jpg"]
}
```

**Response:**
```json
{
  "success": true,
  "filename": "20240112_143022_sunset_16x9.png",
  "url": "/output/20240112_143022_sunset_16x9.png",
  "width": 1820,
  "height": 1024,
  "seed": 123456789,
  "message": "Image generated successfully"
}
```

### POST `/api/upload`
Upload reference image file

**Request:** multipart/form-data with `image_file` and `image_number` fields

**Response:**
```json
{
  "filename": "20240112_143022_image.jpg",
  "url": "/uploads/20240112_143022_image.jpg",
  "message": "File uploaded successfully"
}
```

**Usage:**
- Upload 1 reference image: AI uses it as primary reference
- Upload 2 reference images: AI combines both for more complex generation
- Thumbnails automatically generated for preview (150x150px)

### GET `/health/check`
Health status check

**Response:**
```json
{
  "status": "healthy",
  "timestamp": 1704123456.789,
  "version": "1.0.0",
  "uptime": 3600
}
```

## üß™ Testing

### Run Tests
```bash
# Install dev dependencies
pip install -r requirements-dev.txt

# Run all tests
pytest

# Run with coverage
pytest --cov=bananaai --cov-report=html

# Run specific test file
pytest tests/test_api.py
```

### Code Quality
```bash
# Format code
black .

# Check code style
flake8 .
```

## üõ°Ô∏è Security Features

- **Rate Limiting**: Prevents API abuse with configurable limits
- **CSRF Protection**: Protects against cross-site request forgery
- **Input Validation**: Validates all user inputs
- **File Type Checking**: Only allows safe image formats
- **Filename Sanitization**: Prevents directory traversal attacks
- **Security Headers**: Adds X-Frame-Options, CSP, etc.

## üö¶ Development

### Local Development
```bash
# Run in debug mode
python app.py

# The app runs on http://127.0.0.1:8000
```

### Adding New Features

1. Create service in `bananaai/services/`
2. Add route in appropriate blueprint
3. Add tests in `tests/`
4. Update configuration if needed

### Monitoring

Check application health:
```bash
curl http://127.0.0.1:8000/health/check
```

Check readiness:
```bash
curl http://127.0.0.1:8000/health/ready
```

Get statistics:
```bash
curl http://127.0.0.1:8000/health/stats
```

## üìù License

This project is for educational purposes.

## ü§ù Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## üêõ Troubleshooting

### Common Issues

**Missing API Key**
- Make sure `.env` file exists and contains `GEMINI_API_KEY`

**Import Errors**
- Ensure virtual environment is activated
- Run `pip install -r requirements.txt`

**Port Already in Use**
- Change port in `app.py` or kill the process using port 8000

**File Upload Issues**
- Check that `uploads/` directory exists
- Verify file size is under the limit (default 20MB)
- Ensure image formats are supported (JPG, PNG, GIF)
- Try uploading one image at a time if both uploads fail

**Multiple Reference Images**
- Only image 1 is required, image 2 is optional
- Both images will be combined by AI if provided
- Thumbnails should appear immediately after upload
- Check browser console for JavaScript errors if thumbnails don't show

## üìß Support

For issues and questions, please open an issue on GitHub.

---

Built with ‚ù§Ô∏è using Flask and Google Gemini 2.5 Flash

## üÜï What's New in v2.0

### üñºÔ∏è Multiple Reference Images Support
- **Upload 1-2 Images**: Choose between single or dual reference images
- **Smart Combination**: AI intelligently blends multiple references
- **Thumbnail Previews**: 150x150px thumbnails with hover effects
- **Flexible Usage**: Works with 0, 1, or 2 reference images

### üé® Enhanced UI/UX
- Separate upload sections for each reference image
- Real-time thumbnail generation
- Improved file handling and validation
- Better visual feedback for multi-image uploads

### ‚öôÔ∏è Technical Improvements
- Updated API to handle multiple reference images
- Enhanced Banana AI client for multi-image processing
- Improved error handling and logging
- Better file management and cleanup
